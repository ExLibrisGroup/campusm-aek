auth = require("../auth")
npm = require("../npm")


module.exports = (name)->
  name:name
  help:"#{name} a package or packages (see npm #{name})"
  options:[
    {
      name:"username"
      message:"Please enter your App Manager username"
      noPrompt:true
    }
    {
      name:"password"
      message:"Please enter your App Manager password"
      inputType:"password"
      noPrompt:true
    }
    {
      name:"save"
      flag:"boolean"
    }
    {
      name:"save-dev"
      flag:"boolean"
    }
    {
      name:"save-optional"
      flag:"boolean"
    }
    {
      name:"save-exact"
      flag:"boolean"
    }
    {
      abbr:"g"
      name:"global"
      flag:"boolean"
    }

  ]
  callback:(options)->
    
    auth.getUserDetails(options)
      .then (userDetails)->

        argv = process.argv.slice(process.argv.indexOf(name)+1)
        
        argv.forEach (arg,i)->
          if arg.indexOf("-")==0
            return
          if arg.match(/[\/\\]/)
            return
          argv[i]="@ombiel/"+arg

        npm.command(name,argv)



