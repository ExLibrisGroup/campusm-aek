npm = require "./npm"
config = require "./config"
registryBase = config.registry.replace(/^https?\:\/\//,"//")+"/:"
Promise = require("rsvp").Promise



utils = 
  obj2Args:(obj)->
    out = []
    for key,val of obj
      out.push "--#{key}"
      out.push val
    return out

  npmGet:(key)->
    return new Promise (resolve,reject)->
      npm.command("get",[registryBase+key],"pipe")
        .then (val)->
          if val=="undefined"
            val = undefined
          resolve(val)
        .catch (e)->
          reject(e)

  npmSet:(key,value)->
    npm.command "set",[registryBase+key,value]

  npmDelete:(key)->
    npm.command "config",["delete",registryBase+key]
    
  getDC: (username)->
    userSplit = username.split("::");
    dc = {};
    
    if userSplit.length > 1
      dc.code = userSplit[0]
      dc.username = userSplit[1]
    else 
      dc.code = "eu"
      dc.username = username

    dc.appManagerBase = config.appManagerBases[dc.code];

    return dc;


module.exports = utils
    
