## Form

### Basic usage


``` javascript

var Form = require("@ombiel/aek-lib/react/components/form");

var fields = [
  {name:"name"},
  {name:"email"}
]

var data = {
  name:"Joe Bloggs",
  email:"joe@bloggs.com"
};

return <Form fields={fields} data={data}/>;

```

### Properties

Property            | Type            | Descripion 
--------------------|-----------------| -----------
**`bodyComponent`** | `ReactComponent`| Optionally provide a component to render the form body. The component will inherit the `Form` properties but with an enhanced `fields` property 
**`fields`**        | `Array`         | Form fields - see Fields below
**`formBottom`**    | `ReactFragment` | Content to add to the bottom of the form
**`formTop`**       | `ReactFragment` | Content to add to the top of the form
**`validation`**    | `IValidation`   | See Validation below

### Events

Event           |  Descripion 
----------------|----------------
**`onChange`**  | Fired every time a form field changes
**`onSubmit`**  | Fired when the form is submitted


_Additional properties will be used as attributes or eventHandlers on the generated DOM node as supported by React [supported events](https://facebook.github.io/react/docs/events.html#supported-events) and [supported attributes](https://facebook.github.io/react/docs/tags-and-attributes.html#html-attributes)_

--------

### Simple Example

`Form` components are usually provided with a `fields` property and a `data` property. The `fields` property is array of objects, each of which represents a field in the form. The `data` property is an object to populate the fields with values. Each field has a `name` property that marries up with a key on the `data` object.

Additional properties can be added to each field object and these are passed on as properties for the resulting [`Field`](field) component that is generated. 

<script type="text/aek-example" data-component="Example">
    
  var Segment = require("@ombiel/aek-lib/react/components/segment");
  var Form = require("@ombiel/aek-lib/react/components/form");
  var _ = require("@ombiel/aek-lib/utils");
  var Divider = require("@ombiel/aek-lib/react/components/divider")

  var fields = [
    {name:"name"},
    {name:"email",type:"email"},
    [<Divider/>],
    {name:"confirm",type:"checkbox",label:"I confirm the above is correct"}
  ];

  var Example = React.createClass({

    getInitialState:function() {
      return {
        formData:{
          name:"Joe Bloggs",
          email:"joe@bloggs.com"
        }
      };
    },

    onChange:function(e,name,value) {
      var formData = _.extend({},this.state.formData,{[name]:value});
      this.setState({formData:formData});
      
    },

    render:function() {

      var json = JSON.stringify(this.state.formData,null,2);

      return (
        <div>
          <Segment>
            <Form data={this.state.formData} fields={fields} onChange={this.onChange}/>
          </Segment>
          <Segment>
            <pre>{json}</pre>
          </Segment>
        </div>
      )
    }

  });

</script>

### Validation

The `validation` property provides a way to apply a validation message to each of the form's fields. The `validation` value should follow the `IValidation` interface below

``` javascript

IValidation {
  valid:boolean;
  messages:{[key:string]:string}
}

// example
var validation = {
  valid:false,
  messages:{
    name:"You must complete this field",
    email:"This is not a valid email address"
  }
};

```

#### Simple Validation Example 

<script type="text/aek-example" data-component="Example">
    
  var Segment = require("@ombiel/aek-lib/react/components/segment");
  var Form = require("@ombiel/aek-lib/react/components/form");
  var _ = require("@ombiel/aek-lib/utils");
  var Divider = require("@ombiel/aek-lib/react/components/divider")

  var fields = [
    {name:"name"},
    {name:"email",type:"email"},
    {name:"postcode"},
    [<Divider/>],
    {name:"confirm",type:"checkbox",label:"I confirm the above is correct"}
  ];

  var data = {
    name:"Joe Bloggs",
    email:"myy@@typeo.co.",
    postcode:"PKJGHH"
  };

  var validation = {
    valid:false,
    messages:{
      "email":"This is not a valid email address",
      "postcode":"Please check your postcode",
      "confirm":"You must confirm the above to continue"
    }
  }

  var Example = React.createClass({

    render:function() {

      return <Form validation={validation} fields={fields} data={data}/>;
          
    }
  });

</script>


#### Using validation

A validation object is usually generated by some sort of validator function


<script type="text/aek-example" data-component="Example">
    
  var Segment = require("@ombiel/aek-lib/react/components/segment");
  var Form = require("@ombiel/aek-lib/react/components/form");
  var _ = require("@ombiel/aek-lib/utils");
  var Divider = require("@ombiel/aek-lib/react/components/divider");
  var {Grid,Col,Row} = require("@ombiel/aek-lib/react/components/grid");
  var {AttachedLabel} = require("@ombiel/aek-lib/react/components/label");
  var Button = require("@ombiel/aek-lib/react/components/button");

  var fields = [
    {name:"name",required:true},
    {name:"email",type:"email",required:true},
    {name:"tel",label:"Phone Number",required:true},
    {name:"age",required:true},
    {name:"password",type:"password",required:true},
    {name:"passwordConfirm",label:"Please re-enter your password",type:"password",required:true},
    [<Divider/>],
    {name:"confirm",type:"checkbox",label:"I confirm the above is correct"}
  ];

  var Example = React.createClass({

    getInitialState:function() {
      return {
        formData:{}
      };
    },

    onChange:function(e,name,value) {
      var formData = _.extend({},this.state.formData,{[name]:value});
      this.setState({formData:formData});
    },

    validate:function() {
      var valid = true;
      var messages = {};
      var formData = this.state.formData;

      // check all requied fields have been completed
      fields.forEach(function(field) {
        var val = formData[field.name];
        if(field.required && !val) {
          valid = false;
          return;
        }
      });
      
      // Check validity of email
      if(formData.email && !(_.validateEmail(formData.email))) {
        valid = false;
        messages["email"] = "Sorry, this is not a valid email address";
      }

      // Check validity of postcode
      if(formData.tel && !(_.validateTel(formData.tel))) {
        valid = false;
        messages["tel"] = "Sorry, this is not a valid phone number";
      }

      // Check age is a number and is over 70
      if(formData.age) {
        let age = parseInt(formData.age);
        if(!age) {
          valid = false;
          messages["age"] = "Sorry, that is not a valid age";
        }
        else if(age<70) {
          valid = false;
          messages["age"] = "You must be at least 70 to qualify";
        }
      }

      // check the passwords are equal
      if(formData.password && formData.passwordConfirm && (formData.password !== formData.passwordConfirm)) {
        valid = false;
        messages["passwordConfirm"] = "The passwords did not match";
      }

      valid = valid && formData.confirm;

      return {valid,messages}
    },

    render:function() {

      var validation = this.validate();

      // lets blank the password data out of the displayed data
      var displayData = _.clone(this.state.formData);
      displayData.password = displayData.password && displayData.password.replace(/./gi,"*") || undefined;
      displayData.passwordConfirm = displayData.passwordConfirm && displayData.passwordConfirm.replace(/./gi,"*") || undefined;
      
      var formJSON = JSON.stringify(displayData,null,2);
      var validationJSON = JSON.stringify(validation,null,2);

      var formBottom = [<Divider/>,<Button type="submit" disabled={!validation.valid} variation="positive">Submit</Button>];

      return (
        <div>
          <Segment>
            <Form data={this.state.formData} validation={validation} fields={fields} onChange={this.onChange} formBottom={formBottom}/>
          </Segment>
          <Grid>
            <Row>
              <Col>
                <Segment>
                  <AttachedLabel top right>Form Data</AttachedLabel>
                  <pre style={{height:"200px"}}>{formJSON}</pre>
                </Segment>
              </Col>
              <Col>
                <Segment>
                  <AttachedLabel top right>Validation</AttachedLabel>
                  <pre style={{height:"200px"}}>{validationJSON}</pre>
                </Segment>
              </Col>
            </Row>
          </Grid>
        </div>
      );
    }
  });
</script>

-------

### Form Body Component

The `Form` component comes with a default `bodyComponent` that looks like this

``` javascript

var FormBody = React.createClass({

  render:function() {

    var body = [];
    var fields = this.props.fields || [];
    fields.forEach(function(field) {
      if(_.isArray(field)) { body = body.concat(field); }
      else {
        body.push(<Field {...field}/>);
      }
    });

    return <div>{body}</div>;

  }
});

```

This is used in all of the above examples and works well for common cases. Sometimes you may have more complex requirements and need better control over the form's body. This might include adding additional messages and/or conditional fields.

<script type="text/aek-example" data-component="MyForm">
    
  var Segment = require("@ombiel/aek-lib/react/components/segment");
  var Form = require("@ombiel/aek-lib/react/components/form");
  var Field = require("@ombiel/aek-lib/react/components/field");
  var _ = require("@ombiel/aek-lib/utils");
  var Divider = require("@ombiel/aek-lib/react/components/divider");
  var Header = require("@ombiel/aek-lib/react/components/header");
  var Button = require("@ombiel/aek-lib/react/components/button");
  var {WarningMessage,SuccessMessage} = require("@ombiel/aek-lib/react/components/message");


  var fields = [
    {name:"username",required:true},
    {name:"password",type:"password",required:true},
    {name:"passwordConfirm",label:"Please re-enter your password",type:"password",required:true},
    {name:"notify",type:"toggle",label:"Send me notifications"},
    {name:"notifyEmail",type:"toggle",label:"Send me notifications via email"},
    {name:"email",hideLabel:true,placeholder:"Email address",type:"email",required:true},
    {name:"notifyTel",type:"toggle",label:"Send me notifications via SMS"},
    {name:"tel",hideLabel:true,placeholder:"Mobile Number",required:true}
    
  ];

  // function to check that a password contains lowercase, uppercase and numeric characters
  function passwordIsStrong(password) {
    return (password.length > 7 && password.match(/\d/) && password.match(/[a-z]/) && password.match(/[A-Z]/))
  }

  // Form Body Component
  var MyFormBody = React.createClass({
    
    getField:function(fieldName,additionalProps) {
      var field = _.findWhere(this.props.fields,{name:fieldName});
      return field && <Field {...field} {...additionalProps}/>;
    },

    render:function() {
      
      var passwordWarning = <Divider/>;
      var notifications = [this.getField("notify")];
      var data = this.props.data; // inherited from Form
      var content = [];
      

      content.push(this.getField("username"));
      content.push(this.getField("password"));

      var password = data.password;
      var passwordConfirmValidation = null;

      if(password && data.passwordConfirm) {
        if(password === data.passwordConfirm) {
          if(passwordIsStrong(password)) {
            passwordWarning = <SuccessMessage heading="Strong Password">Your password is strong</SuccessMessage>;
          }
          else {
            passwordWarning = <WarningMessage heading="Weak Password">Your password should be at lease 8 characters long and contain numbers and both uppercase and lowercase letters</WarningMessage>;
          }
        }
        else {
          passwordConfirmValidation = "The passwords did not match";
        }
      }
      
      content.push(this.getField("passwordConfirm",{validation:passwordConfirmValidation}));
      content.push(passwordWarning);
      content.push(this.getField("notify"))


      if(data.notify) {
        let notificationFields = [this.getField("notifyEmail")];

        if(data.notifyEmail) { notificationFields.push(this.getField("email")) }

        notificationFields.push(this.getField("notifyTel"));  

        if(data.notifyTel) { notificationFields.push(this.getField("tel")) }

        content.push(
          <Segment>
            <Header dividing level="4">Notifications</Header>
            {notificationFields}
          </Segment>
        );
      }
      else {
        content.push(<Divider/>);
      }

      return (
        <div>
          {content}
          <Button type="submit">Submit</Button>
        </div>
      );
    }
  });

  // Example Component
  var MyForm = React.createClass({

    getInitialState:function() {
      return {
        formData:{}
      };
    },

    onChange:function(e,name,value) {
      var formData = _.extend({},this.state.formData,{[name]:value});
      this.setState({formData:formData});
    },

    render:function() {

      return (
        <div>
          <Segment>
            <Form data={this.state.formData} fields={fields} onChange={this.onChange} bodyComponent={MyFormBody} />
          </Segment>
        </div>
      );
    }
  });
</script>


### Other input types

<script type="text/aek-example" data-component="Example">
    
  var Segment = require("@ombiel/aek-lib/react/components/segment");
  var Form = require("@ombiel/aek-lib/react/components/form");
  var _ = require("@ombiel/aek-lib/utils");
  var Divider = require("@ombiel/aek-lib/react/components/divider");
  var DateInput = require("@ombiel/aek-lib/react/components/date-input");

  var fields = [
    {name:"text",type:"text",placeholder:"Text Input"},
    {name:"checkbox",type:"checkbox"},
    {name:"toggle",type:"toggle"},
    {name:"slider",type:"slider"},
    {name:"textarea",type:"textarea",maxChars:320,placeholder:"Textarea Input"},
    {name:"select",type:"select",placeholder:"Please choose an option",options:["one","two",["three",3]]},
    {name:"date",type:DateInput,inputProps:{dateValueFormat:"Do MMMM YYYY"}}
    
  ];

  var Example = React.createClass({

    getInitialState:function() {
      return {
        formData:{}
      };
    },

    onChange:function(e,name,value) {
      var formData = _.extend({},this.state.formData,{[name]:value});
      this.setState({formData:formData});
      
    },

    render:function() {

      var json = JSON.stringify(this.state.formData,null,2);

      return (
        <div>
          <Segment>
            <Form data={this.state.formData} fields={fields} onChange={this.onChange}/>
          </Segment>
          <Segment>
            <pre>{json}</pre>
          </Segment>
        </div>
      )
    }

  });

</script>
