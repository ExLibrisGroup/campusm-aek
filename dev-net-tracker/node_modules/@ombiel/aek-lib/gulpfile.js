"use strict";
var gulp = require("gulp");
var runSequence = require("run-sequence");
var aekGulp = require("@ombiel/aek-buildtools").gulp;
// var screens = aekGulp.screens;
// var css = aekGulp.css();
// var predeploy = aekGulp.predeploy();
// var aek = require("@ombiel/aek-cli");
var nodemon = require("gulp-nodemon");
var path = require("path");



/* ---- GULP TASKS ---------- */

gulp.task("webpack",function() {
  return aekGulp.webpack(false,{
    srcBase:path.resolve(__dirname,"docs/webpack_src"),
    dest:path.resolve(__dirname,"docs/js"),
    alias:{
      "@ombiel/aek-lib":path.resolve("./"),
      "-aek":path.resolve("./"),
      "-components":path.resolve("./react/components")
    }
    // externals:{"react":"React"}
  });
});
// gulp.task("webpack_prod",function() { return aekGulp.webpack(true); });
// gulp.task("css",css.dev);
// gulp.task("css_prod",css.prod);
// gulp.task("screens",function() { return screens(true); });
// gulp.task("screens_prod",function() { return screens(false); });


// watch - watch src folders for changes and automatically rebuild dev assets
gulp.task("watch",function() {
  // gulp.watch(["src/client/css/**/*.*"],["css"]);
  gulp.watch(["**/*.js","**/*.coffee","**/*.jsx","!node_modules/**/*.*","!docs/js/**.*"], ["webpack"]);
  // gulp.watch(["src/screens/**/*.*","src/emails/**/*.*"], ["screens","screens_prod"]);
});

// start dev server
// gulp.task("runserver",function() { aek.cli.parse("runserver"); });

gulp.task("runserver",function() {
  require("./node_modules/@ombiel/aek-docserver/server.js");
});

// predeloy task is triggered from `aek deploy` command
// gulp.task("_predeploy",predeploy);

// start task is triggered from `aek start` command
// gulp.task("start",["webpack","css"], function() {
//   runSequence(["screens"],["screens_prod","watch","runserver"]);
// });
gulp.task("start",["runserver"],function() {
  runSequence("webpack","watch");
});

// default gulp task
gulp.task("default",['start']);

// must export this for use with aek-cli
module.exports = gulp;
