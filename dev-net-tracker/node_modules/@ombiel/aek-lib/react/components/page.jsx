var utils = require("../../utils");
var React = require("react");
var ReactDOM = require("react-dom");
var mergeProps = require("../utils/merge-props");
var Panel = require("./panel");

var scrollPositions = {};


var Page = React.createClass({

  componentWillMount:function() {
    this.updateScrollPosition = utils.debounce(this.updateScrollPosition,200);
  },

  updateScrollPosition:function() {
    var domNode = ReactDOM.findDOMNode(this);
    var id = domNode.getAttribute("data-reactid");
    var {scrollTop,scrollLeft} = domNode;
    scrollPositions[id] = {scrollTop,scrollLeft};
  },

  onScroll:function(e) {
    this._hasScrolled = true;
    this.updateScrollPosition();

    if(this.props.onScroll) {
      this.props.onScroll(e);
    }
  },

  render:function() {

    var props = mergeProps({className:"page"},this.props);

    return <Panel onScroll={this.onScroll} {...props} />;

  },

  componentDidMount:function() {
    if(!this._hasScrolled) {
      var domNode = ReactDOM.findDOMNode(this);
      var {scrollLeft,scrollTop} = scrollPositions[domNode.getAttribute("data-reactid")] || {};
      if(scrollLeft) {
        domNode.scrollLeft = scrollLeft;
      }
      if(scrollTop) {
        domNode.scrollTop = scrollTop;
      }

    }
  }
});

module.exports = Page;
