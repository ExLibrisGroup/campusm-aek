var _ = require("../utils");

var defaults = {
  target:"_blank"
};

module.exports = (url,data = {},opts = {})=>{
  opts = _.merge({},defaults,opts);


  if(_.isNative()) {
    data = _.extend({_cm_url_:url},data);
    var params = _.param(data);
    _.openURL(`campusm://postURL?${params}`);
  }

  else {

    var form = document.createElement("form");
    form.setAttribute("action",url);
    form.setAttribute("target",opts.target);
    form.setAttribute("style","display:none");
    form.setAttribute("method","POST");

    for(let key in data) {
      let input = document.createElement("input");
      input.setAttribute("type","hidden");
      input.setAttribute("value",data[key]);
      input.setAttribute("name",key);
      form.appendChild(input);
    }

    document.body.appendChild(form);
    form.submit();
    document.body.removeChild(form);
  }

};
