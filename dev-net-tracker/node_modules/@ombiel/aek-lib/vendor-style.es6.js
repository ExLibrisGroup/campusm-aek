var prefixes = {};
var _ = require("./utils");
var style;
var vendorPrefixes = ["","webkit","moz","ms","o"];


function getVendorKey(key) {
  if(!style) { style = window.document.body.style; }
  if(prefixes[key]===undefined) {  
    var capKey = key.substring(0,1).toUpperCase() + key.substr(1),
        vendorKey;
    
    _.find(vendorPrefixes,function(prefix) {
      var vKey = prefix && prefix+capKey || key;
      if(style[vKey]!==undefined) {
        if(_.contains(["webkit","moz","o"],prefix)) {
          vendorKey = prefix.substring(0,1).toUpperCase()+prefix.substr(1)+capKey;
        }
        else{
          vendorKey = vKey;
        }
        return true;
      }
      return false;
    });

    prefixes[key] = vendorKey;
  }
  return prefixes[key];
}


module.exports = {
  prefix:function(styles) {

    if(_.isString(styles)) {
      return getVendorKey(styles) || styles;
    }

    var out = {};
    _.each(styles,function(value,key) {
      var vendorKey = getVendorKey(key) || key;
      out[vendorKey] = value;
    });

    return out;
  },
  hasProperty:function(key) {
    return !!getVendorKey(key);
  }
};
