var utils = require("../utils");

var cmUrl = module.exports = {
  invoke:function(type,params) {
    utils.each(params,function(value,key) {
      if(utils.isFunction(value)) {
        var cbID = utils.uniqueId('__campusm_ncb_');
        window[cbID] = value
        params[key] = cbID
      }
    });
    
    return this.callUrl(`campusm://${type}?`+utils.param(params))
  },

  callUrl:function(url) {
    var iframe = document.createElement('iframe')
    iframe.style.display = 'none'
    document.body.appendChild(iframe);
    
    iframe.contentWindow.location = url

    // discard the iframe after a delay
    // tried to do this onLoad but doesn't seem to work
    setTimeout(function() {
      document.body.removeChild(iframe)
    },1000)
  }
}