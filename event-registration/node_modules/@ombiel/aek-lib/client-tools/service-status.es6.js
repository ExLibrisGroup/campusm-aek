// WARNING: only currently available on homescreen - not AEK

var EventEmitter = require("-aek/event-emitter");
var clientTools = require("-aek/client-tools");


class ServiceStatusListener extends EventEmitter {
  constructor(params = {}) {
    super();
    params.cb = this.trigger.bind(this);
    clientTools.invoke("requestServiceStatus",params);
  }
}

ServiceStatusListener.getServiceStatus = function(opts = {}) {

  var timeout = opts.timeout || 3000;

  return new Promise(function(resolve,reject) {
    var tOut = setTimeout(()=>{
      reject(Error("SERVICE_STATUS_TIMEOUT"));
    },timeout);

    var listener = new ServiceStatusListener();

    var cleanUp = ()=>{
      clearTimeout(tOut);
      listener.off();
    };

    listener.on("servicesUpdate",(obj)=>{
      cleanUp();
      resolve(obj);
    });
    listener.on("error",(err)=>{
      cleanUp();
      reject(Error(err));
    });
  });
};

module.exports = ServiceStatusListener;
