
var react = require("react")
var $ = window.jQuery = require("jquery");

$.fn.dropdown = require("semantic/modules/dropdown");



var utils = require("../../utils");

module.exports = React.createClass({
  render: function() {
    var props = this.props,
        value = this.props.value;
    
    var options = this.props.options.map(function(option) {
      
      if(utils.isString(option) || utils.isNumber(option)) {
        option = {value:option,label:option};
      }

      var className = "item";
      if(option.value == value) {
        className += " active"
      }

      if(option.className) {
        className += " "+option.className;
      }

      return <div className={className} data-value={option.value}>{option.label}</div>;
    });
    

    var className = "ui selection dropdown";
    if(props.className) {
      className += " "+props.className
    }

    return (
      <div className={className}>
        <input type="hidden" ref="hiddenInput" name={this.props.name} value={value}/>
        <i className="dropdown left icon"></i>
        <div className="text">{props.label}</div>
        
        <div className="menu">
          {options}
        </div>
        {this.props.requiredMarker}
      </div>
    );


  },
  componentDidMount: function() {
    console.log("$",$)
    console.log("domNode",this.getDomNode)
    $(this.getDOMNode()).dropdown({
      onChange: this.onChange
    });
  },
  onChange: function(val) {
    var onChange = this.props.onChange;
    
    var hiddenInput = this.refs.hiddenInput.getDOMNode();
    hiddenInput.value = val;

    if(onChange) {
      onChange(null,this.props.name,val);
    }
  }
})