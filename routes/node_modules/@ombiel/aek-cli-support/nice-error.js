const _ = require("lodash");
const PrettyError = require('pretty-error');
const pe = new PrettyError();
const log = require("./logger");

pe.skipPath(__filename);

let _hasStarted;
function start() {
  if (!_hasStarted) {
    pe.start();
    _hasStarted = true;
  }
}

function renderNiceError(err) {
  if (!err) { err = Error("Unknown Error"); }
  if (!_.isError(err)) { err = Error(err); }
  return pe.render(err);
}

function printNiceError(err) {
  if (_.isNumber(err)) {
    log.error(`Exit code ${err}`);
    return;
  }
  if (err && err.isFriendly) {
    log.error(err.message);
    return;
  }
  console.log(renderNiceError(err)); // eslint-disable-line no-console
}

function FriendlyError(...args) {
  const err = Error(...args);
  err.isFriendly = true;
  return err;
}

module.exports = {start,renderNiceError,printNiceError,FriendlyError};
