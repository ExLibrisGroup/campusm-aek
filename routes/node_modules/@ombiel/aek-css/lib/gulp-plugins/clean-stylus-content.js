"use strict";

var thru = require("through2").obj;
var chalk = require("chalk");


module.exports = function() {
  return thru(function(file,enc,cb) {
    var contents = file.contents.toString();
    
    console.log(chalk.yellow("cleanStylusContents:"),file.relative);

    // fix ribbon label issues with negative values - Can this be removed rich?
    // contents = contents.replace(
    //   'ribbonOffset = unquote("calc(") - ribbonMargin ribbonMargin unquote(" - ") ribbonTriangleSize unquote(")")',
    //   'ribbonOffset = unquote("calc(") -ribbonMargin ribbonMargin unquote(" - ") ribbonTriangleSize unquote(")")'
    // );
    // contents = contents.replace(
    //   'ribbonImageOffset = unquote("calc(") - ribbonImageMargin ribbonImageMargin unquote(" - ") ribbonTriangleSize unquote(")")',
    //   'ribbonImageOffset = unquote("calc(") -ribbonImageMargin ribbonImageMargin unquote(" - ") ribbonTriangleSize unquote(")")'
    // );

    contents = contents.replace(/\\3/g,"\\\\3");

    // this line causes problems in conversion (found in steps.override)
    // lets remove it here and apply it in stylus override file
    contents = contents.replace(/\@font\-face(.|\n)*(Step|Checkbox)(.|\n)*src\s*\:\s*data\:(.*)/gi,"");

    // contents = contents.replace(/\@font\-face(.|\n)*Checkbox(.|\n)*src\s*\:\s*data\:(.*)/gi,"");
    


    file.contents = new Buffer(contents);

    this.push(file);

    cb();

  });
};
