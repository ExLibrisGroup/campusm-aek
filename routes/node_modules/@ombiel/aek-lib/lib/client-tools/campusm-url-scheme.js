import {isFunction,forEach,uniqueId} from "lodash";
import {param} from "../utils";

export default {
  invoke: function(type,params) {
    forEach(params,function(value,key) {
      if (isFunction(value)) {
        var cbID = uniqueId('__campusm_ncb_');
        window[cbID] = value;
        params[key] = cbID;
      }
    });

    return this.callUrl(`campusm://${type}?${param(params)}`);
  },

  callUrl: function(url) {
    var iframe = document.createElement('iframe');
    iframe.style.display = 'none';
    document.body.appendChild(iframe);

    iframe.contentWindow.location = url;

    // discard the iframe after a delay
    // tried to do this onLoad but doesn't seem to work
    setTimeout(function() {
      document.body.removeChild(iframe);
    },1000);
  }
};
