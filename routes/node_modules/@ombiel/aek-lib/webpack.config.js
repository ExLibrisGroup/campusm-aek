const Path = require("path");
const {set} = require("lodash");
const docServerMiddleware = require("@ombiel/aek-docserver/middleware");

module.exports = ()=>{

  const webpackConfig = require("@ombiel/aek-webpack")();

  webpackConfig.entry = {
    "/js/aek-lib": Path.resolve("./docs/webpack_src/aek-lib.js"),
  };

  set(webpackConfig,["resolve","alias","@ombiel/aek-lib"],Path.resolve("./"));

  webpackConfig.output = {
    path: Path.resolve(__dirname,"docs"),
    filename: "[name].js",
  };

  webpackConfig.devServer = {
    before(app) {
      app.use((req,res,next)=>{
        if (req.url === "/") {
          req.url = "/index";
        }
        next();
      });
    },
    after(app) {
      app.use(docServerMiddleware());
    },
    stats: webpackConfig.stats,
  };

  return webpackConfig;
};
