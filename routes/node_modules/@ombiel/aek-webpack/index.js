const Path = require("path");
const glob = require("glob");
const cmWebpack = require("@ombiel/cm-webpack");


function getEntry(srcBase) {
  const files = glob.sync("/*.{jsx,js}",{root: srcBase});
  const out = {};
  files.forEach(function(filename) {
    out[Path.basename(Path.basename(filename,Path.extname(filename)),".es6")] = Path.resolve(filename);
  });
  return out;
}

module.exports = (opts = {})=>{
  opts = Object.assign({
    buildPrefix: "aek",
    babelConfig: require.resolve("@ombiel/babel-preset-aek"),
  },opts);

  const config = cmWebpack(opts);

  const srcBase = opts.srcBase || process.env.AEK_WEBPACK_SRC_BASE || "./src/client";

  config.entry = getEntry(srcBase);

  return config;

};
