import {debounce} from "lodash";
import {getWindowDimensions} from "../../utils";

export default function windowSizePlugin(propName = "$$$windowSize") {

  return function(store) {

    var ctx = store.context({group: "WINDOWSIZE",path: propName});

    store.on("init",function() {
      var dimensions = getWindowDimensions();
      ctx.dispatch({
        name: "init",
        payload: dimensions,
        replace: dimensions
      });

      window.addEventListener("resize",debounce(function() {
        var newDimensions = getWindowDimensions();
        ctx.dispatch({
          name: "update",
          payload: newDimensions,
          replace: newDimensions
        });
      },10));
    });
  };
}
