import {merge,extend} from "lodash";
import {isNative,param,openURL} from "../utils";


var defaults = {
  target: "_blank"
};

module.exports = (url,data = {},opts = {})=>{
  opts = merge({},defaults,opts);


  if (isNative()) {
    data = extend({_cm_url_: url},data);
    var params = param(data);
    openURL(`campusm://postURL?${params}`);
  }

  else {

    var form = document.createElement("form");
    form.setAttribute("action",url);
    form.setAttribute("target",opts.target);
    form.setAttribute("style","display:none");
    form.setAttribute("method","POST");

    Object.keys(data).forEach((key)=>{
      const input = document.createElement("input");
      input.setAttribute("type","hidden");
      input.setAttribute("value",data[key]);
      input.setAttribute("name",key);
      form.appendChild(input);
    });

    document.body.appendChild(form);
    form.submit();
    document.body.removeChild(form);
  }

};
